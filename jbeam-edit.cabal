cabal-version:      2.2

-- This file has been generated from package.yaml by hpack version 0.38.0.
--
-- see: https://github.com/sol/hpack

name:               jbeam-edit
version:            0.0.4.0
license:            BSD-3-Clause
license-file:       LICENSE
copyright:          2025 webdevred
maintainer:         example@example.com
author:             webdevred
tested-with:        ghc ==9.4.7 ghc ==9.6.6
homepage:           https://github.com/webdevred/jbeam-edit#readme
bug-reports:        https://github.com/webdevred/jbeam-edit/issues
synopsis:
    A fast and reliable command-line tool for parsing, formatting, and editing JBeam files, supporting consistent node renaming, reference updating, and JBFL-based formatting.

description:
    jbeam-edit is a Haskell-based CLI utility for BeamNG JBeam files. It parses complete JBeam structures, preserves comments and whitespace, formats files consistently, and can automatically rename nodes and update references. Custom formatting rules are supported via JBFL (JBeam Formatting Language). See the README for usage instructions and examples: https://github.com/webdevred/jbeam-edit#readme

category:           Command Line, Jbeam, Beamng
build-type:         Simple
data-files:
    examples/jbfl/complex.jbfl
    examples/jbfl/minimal.jbfl

extra-source-files:
    README.md
    JBFL_DOCS.md
    examples/README.md
    examples/jbeam/fender.jbeam
    examples/jbeam/frame.jbeam
    examples/jbeam/suspension.jbeam
    examples/formatted_jbeam/fender-complex-jbfl.jbeam
    examples/formatted_jbeam/fender-minimal-jbfl.jbeam
    examples/formatted_jbeam/frame-complex-jbfl.jbeam
    examples/formatted_jbeam/frame-minimal-jbfl.jbeam
    examples/formatted_jbeam/suspension-complex-jbfl.jbeam
    examples/formatted_jbeam/suspension-minimal-jbfl.jbeam

source-repository head
    type:     git
    location: https://github.com/webdevred/jbeam-edit

flag dump-ast
    description: Enable building the dump-ast executable (dev-only)
    default:     False
    manual:      True

flag lsp-server
    description: Enable LSP server (experimental)
    default:     False
    manual:      True

flag lsp-test-server
    description: Enable LSP test server (dev-only)
    default:     False

flag transformation
    description: Enable transformation (experimental)
    default:     False
    manual:      True

flag windows-example-paths
    description:
        Use executable-relative example paths (for Windows release builds)

    default:     False
    manual:      True

library
    exposed-modules:
        Core.Node
        Core.NodeCursor
        Core.NodePath
        Core.Result
        Formatting
        Formatting.Config
        Formatting.Rules
        IOUtils
        Parsing.Common
        Parsing.Common.ErrorMessage
        Parsing.Common.Helpers
        Parsing.DSL
        Parsing.Jbeam

    hs-source-dirs:     src
    other-modules:      Paths_jbeam_edit
    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions:
        OverloadedStrings ImportQualifiedPost DerivingStrategies

    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints
        -Wunused-packages

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        megaparsec,
        mtl,
        scientific,
        text >=2.0,
        vector

    if flag(transformation)
        cpp-options: -DENABLE_TRANSFORMATION

    if (os(windows) && flag(windows-example-paths))
        cpp-options: -DWINDOWS_EXAMPLE_PATHS

library jbeam-edit-transformation
    exposed-modules:
        Config
        SupportVertex
        Transformation
        Types
        VectorHelpers
        VertexExtraction

    hs-source-dirs:     src-extra/transformation
    other-modules:      Paths_jbeam_edit
    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector >=0.13

    mixins:
        base hiding (Prelude),
        relude (Relude as Prelude),
        relude

    if flag(transformation)
        build-depends:
            nonempty-vector >=0.2.1,
            relude,
            vector-algorithms,
            yaml

    else
        buildable: False

library jbeam-language-server
    exposed-modules:
        Handlers.Formatting
        Server
        Services.DocumentStore

    hs-source-dirs:     src-extra/language-server
    other-modules:      Paths_jbeam_edit
    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions:
        OverloadedStrings ImportQualifiedPost DataKinds PolyKinds

    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    mixins:
        base hiding (Prelude),
        relude (Relude as Prelude),
        relude

    if flag(lsp-server)
        build-depends:
            lsp >=2.7,
            lsp-types >=2.3,
            relude

    else
        buildable: False

executable jbeam-edit
    main-is:            Main.hs
    hs-source-dirs:     exe/jbeam-edit
    other-modules:
        CommandLineOptions
        Paths_jbeam_edit

    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost CPP
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints
        -threaded -rtsopts -with-rtsopts=-N

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    if flag(transformation)
        cpp-options:   -DENABLE_TRANSFORMATION
        build-depends: jbeam-edit-transformation

    if os(windows)
        cpp-options: -DENABLE_WINDOWS_NEWLINES

executable jbeam-edit-dump-ast
    main-is:            Main.hs
    hs-source-dirs:     tools/dump_ast
    other-modules:      Paths_jbeam_edit
    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints
        -threaded -rtsopts -with-rtsopts=-N

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    if (flag(dump-ast) && flag(transformation))
        build-depends:
            jbeam-edit-transformation,
            pretty-simple >=2

    else
        buildable: False

executable jbeam-lsp-server
    main-is:            Main.hs
    hs-source-dirs:     exe/jbeam-lsp-server
    other-modules:
        CommandLineOptions
        Paths_jbeam_edit

    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints
        -threaded -rtsopts -with-rtsopts=-N

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    if flag(lsp-server)
        build-depends: jbeam-language-server

    else
        buildable: False

test-suite jbeam-edit-test
    type:               exitcode-stdio-1.0
    main-is:            Spec.hs
    build-tool-depends: hspec-discover:hspec-discover
    hs-source-dirs:     test
    other-modules:
        Core.NodeCursorSpec
        Core.NodePathSpec
        Core.NodeSpec
        Formatting.RulesSpec
        FormattingSpec
        Parsing.DSLSpec
        Parsing.JbeamSpec
        SpecHelper
        Paths_jbeam_edit

    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints
        -threaded -rtsopts -with-rtsopts=-N

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        hspec,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    if True
        build-depends:
            hspec-megaparsec,
            megaparsec

test-suite jbeam-edit-transformation-test
    type:               exitcode-stdio-1.0
    main-is:            Main.hs
    hs-source-dirs:     test-extra/transformation
    other-modules:      Paths_jbeam_edit
    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints
        -threaded -rtsopts -with-rtsopts=-N

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        hspec,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    if flag(transformation)
        build-depends: jbeam-edit-transformation

    else
        buildable: False

test-suite jbeam-language-server-test
    type:               exitcode-stdio-1.0
    main-is:            Spec.hs
    build-tool-depends: hspec-discover:hspec-discover
    hs-source-dirs:     test-extra/language-server
    other-modules:
        DocumentStoreSpec
        WorkspaceLspSpec
        Paths_jbeam_edit

    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints
        -threaded -rtsopts -with-rtsopts=-N

    build-depends:
        base >=4.17 && <5,
        bytestring,
        containers,
        directory,
        filepath,
        hspec,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    if flag(lsp-server)
        build-tool-depends: jbeam-edit:jbeam-lsp-server
        build-depends:
            jbeam-language-server,
            lsp >=2.7,
            lsp-test

    else
        buildable: False

benchmark jbeam-edit-bench
    type:               exitcode-stdio-1.0
    main-is:            Main.hs
    hs-source-dirs:     tools/bench
    other-modules:      Paths_jbeam_edit
    autogen-modules:    Paths_jbeam_edit
    default-language:   GHC2021
    default-extensions: OverloadedStrings ImportQualifiedPost
    ghc-options:
        -Wall -Wcompat -Widentities -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wmissing-export-lists
        -Wmissing-home-modules -Wpartial-fields -Wredundant-constraints

    build-depends:
        base,
        bytestring,
        containers,
        directory,
        filepath,
        jbeam-edit,
        mtl,
        scientific,
        text >=2.0,
        vector

    if flag(transformation)
        build-depends:
            criterion,
            jbeam-edit-transformation

    else
        buildable: False
